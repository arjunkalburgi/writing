{"componentChunkName":"component---src-templates-blog-post-js","path":"/Creating-a-Custom-Loading-Spinner-for-Android/","webpackCompilationHash":"0907067a98c78204ce71","result":{"data":{"site":{"siteMetadata":{"title":"Writing","author":"Arjun Kalburgi"}},"markdownRemark":{"id":"f54ade23-edb9-571a-8db0-f463ee219432","excerpt":"Recently at Krugo, I was implementing a custom loading animation. I donâ€™t usually write about work things, but this one was different. First, theÂ Setup First Iâ€¦","html":"<blockquote>\n<p>Recently at Krugo, I was implementing a custom loading animation. I donâ€™t usually write about work things, but this one was different.</p>\n</blockquote>\n<h4>First, theÂ Setup</h4>\n<p>First I implemented this BehaviorSubject in my Dependency Injection:</p>\n<p><strong>var progressBar</strong>: BehaviorSubject<Boolean> = BehaviorSubject.createDefault(<strong>false</strong>)<br>\n<strong>fun</strong> setProgressBar(value: Boolean) {<br>\n<strong>progressBar</strong>.onNext(value)<br>\n}</p>\n<p>And subscribed to it from the MainActivity:</p>\n<p>Injector.<strong>progressBar</strong>.<em>subscribeBy</em>(<br>\nonNext = <strong>{<br>\nif</strong> (<strong>it</strong>) {<br>\n<strong>this</strong>.mainProgress.<em>visibility</em> = View.<em>VISIBLE</em> } <strong>else</strong> {<br>\n<strong>this</strong>.mainProgress.<em>visibility</em> = View.<em>GONE</em> }<br>\n<strong>}</strong>,onError = <strong>{}</strong>)<br>\n.<em>addTo</em>(<strong>compositeDisposable</strong>)</p>\n<p>These together allow me to toggle the ProgressBar view (that was set up in activity_main) simply by calling <code>Injector.setProgressBar(**true**)</code> and <code>Injector.setProgressBar(**false**)</code>.</p>\n<h4>Second, the Animation</h4>\n<p>Hereâ€™s the fun part. I used <a href=\"https://shapeshifter.design/\">Shape Shifter</a> to make the animation, this is what I made:</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/800/1*TOT7NQcg-4VcfbAynbk7vA.gif\"></p>\n<p>Shape Shifter allows you to export the animation as an <code>animated-vector</code>Â , made just for Android.</p>\n<p>I found that breaking that <code>animated-vector</code> into four separate files worked best. The first is the main file, make sure your ProgressBar uses this.</p>\n<p>&#x3C;<strong>animated-vector</strong><br>\nandroid:drawable=\"<strong>@drawable/your_vector_file</strong>\">  </p>\n<pre><code>&#x3C;**target**  \n    android:name=\"group1\"  \n    android:animation=\"**@anim/your\\_first\\_animation\\_file**\" />  \n\n&#x3C;**target**  \n    android:name=\"group2\"  \n    android:animation=\"**@anim/your\\_second\\_animation\\_file**\" />  \n</code></pre>\n<p>&#x3C;/<strong>animated-vector</strong>></p>\n<p>The vector file, taken from the <code>&#x3C;vector></code> section of the <code>animated-vector</code>Â :</p>\n<p>&#x3C;<strong>vector</strong> android:name=\"vector\"<br>\nandroid:viewportWidth=\"1024\"<br>\nandroid:viewportHeight=\"1024\"><br>\n&#x3C;<strong>group</strong> ... /><br>\n&#x3C;<strong>group</strong> ... /><br>\n&#x3C;/<strong>vector</strong>></p>\n<p>And the two animation files taken from the <code>&#x3C;target></code> sections and placed under <code>res/anim/</code>Â . Theyâ€™ll look like this:</p>\n<p>&#x3C;<strong>set</strong>><br>\n&#x3C;<strong>objectAnimator</strong> ... /><br>\n&#x3C;<strong>objectAnimator</strong> ... /><br>\n&#x3C;<strong>objectAnimator</strong> ... /><br>\n&#x3C;<strong>objectAnimator</strong> ... /><br>\n&#x3C;/<strong>set</strong>></p>\n<h4>Third, Making itÂ Work</h4>\n<p>This was all great, but it didnâ€™t exactly work. The animation wouldnâ€™t repeat itself after it completed. Took a while but finally got it working by doing the following:</p>\n<p>Change <code>ProgressBar</code> to <code>ImageView</code></p>\n<p>&#x3C;<strong>ImageView</strong><br>\nandroid:contentDescription=\"@string/loading\"<br>\nandroid:id=\"@+id/progress_bar\"<br>\nandroid:layout_width=\"200dp\"<br>\nandroid:layout_height=\"200dp\"<br>\nandroid:layout_gravity=\"center\" /></p>\n<p>Initialize the animation including <code>registerAnimationCallback</code> to force the looping of the animation.</p>\n<p><strong>val</strong> avd = AnimatedVectorDrawableCompat.create(<em>applicationContext</em>,<br>\nR.drawable.<em>your\\</em>vector_file<em>)<br>\nfindViewById<ImageView>(R.id.</em>progress_bar<em>).</em>apply_ <strong>{</strong> setImageDrawable(avd)<br>\n<strong>}<br>\n**avd?.registerAnimationCallback(</strong>obj<strong>:Animatable2Compat.AnimationCallback() {<br>\n**override fun</strong> onAnimationEnd(drawable: Drawable?) {<br>\navd.start()<br>\n}<br>\n})</p>\n<p>To top it off, I added <code>start()</code> and <code>stop()</code> to my <code>_subscribeBy_</code> method just to be nice:</p>\n<p>Injector.<strong>progressBar</strong>.<em>subscribeBy</em>(<br>\nonNext = <strong>{<br>\nif</strong> (<strong>it</strong>) {<br>\n<strong>this</strong>.mainProgress.<em>visibility</em> = View.<em>VISIBLE</em> avd?<em>.start()</em> } <strong>else</strong> {<br>\n<strong>this</strong>.mainProgress.<em>visibility</em> = View.<em>GONE</em> avd?<em>.stop()</em> }<br>\n<strong>}</strong>,onError = <strong>{}</strong>)<br>\n.<em>addTo</em>(<strong>compositeDisposable</strong>)</p>\n<p>This last step took me a while to figure out but I finally got it thanks to this article from the Android Developers blog:</p>\n<p><a href=\"https://medium.com/androiddevelopers/re-animation-7869722af206\" title=\"https://medium.com/androiddevelopers/re-animation-7869722af206\"><strong>Re-animation</strong><br>\n<em>If you were holding off adding awesome animation to your application because of lack of API support, then hold-off-no-more</em>medium.com</a><a href=\"https://medium.com/androiddevelopers/re-animation-7869722af206\"></a></p>\n<p>Overall I loved the chance to work on some animation, I think itâ€™s just going to become a bigger thing in 2019 and more of a priority for me to learn!</p>\n<h4>Krugo Travel</h4>\n<p>Quick shoutout to the company Iâ€™m working for, Krugo. Iâ€™m working on getting the Android app up and running hence why I was doing this little animation in Android!</p>\n<blockquote>\n<p>Have you ever been frustrated trying to plan a trip with a group of people? Maybe a bachelor party, family vacation or trip with the girls? If so, youâ€™re not alone.</p>\n</blockquote>\n<blockquote>\n<p>And weâ€™ve made it our mission to help.</p>\n</blockquote>\n<p>Krugo helps groups of friends collaboratively plan trips by finding events, buying tickets and getting a place to stay. Canâ€™t wait to take my own Krugo soon ðŸ˜œ</p>\n<p>Check â€™em out on <a href=\"https://medium.com/@krugo\">Medium</a> or get the <a href=\"https://krugotravel.com/\">app for iOS</a>. Android coming soon!</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/800/1*OoTeOBZ4tF09RWuXkXNihA.jpeg\"></p>","frontmatter":{"title":"Creating a Custom Loading Spinner for Android ðŸ¤–","date":"January 15, 2019","description":"Recently at Krugo, I was asking to implement a custom loading animation. I donâ€™t usually write about work things, but this one wasâ€¦"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/Creating-a-Custom-Loading-Spinner-for-Android/","previous":{"fields":{"slug":"/Stressful-Tasks--a-behavioural-design-experiment/"},"frontmatter":{"title":"Stressful Tasks, a behavioural design experiment"}},"next":{"fields":{"slug":"/Getting-more-and-more-used-to-animations/"},"frontmatter":{"title":"Getting more and more used to animations ðŸš€"}}}}}