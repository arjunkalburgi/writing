{"hash":"6eabbf701c27e0f138715934013e7acffa4749e7","data":{"post":{"id":"1f50b106ca8642c90b34aa8c6a8f4d91","title":"Creating a Custom Loading Spinner for Android ðŸ¤–","content":"<blockquote>\n<p>Recently at Krugo, I was implementing a custom loading animation. I donâ€™t usually write about work things, but this one was different.</p>\n</blockquote>\n<h4 id=\"first-the-setup\"><a href=\"#first-the-setup\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>First, theÂ Setup</h4>\n<p>First I implemented this BehaviorSubject in my Dependency Injection:</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> progressBar<span class=\"token operator\">:</span> BehaviorSubject<span class=\"token operator\">&lt;</span>Boolean<span class=\"token operator\">></span> <span class=\"token operator\">=</span> BehaviorSubject<span class=\"token punctuation\">.</span><span class=\"token function\">createDefault</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>  \nfun <span class=\"token function\">setProgressBar</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value<span class=\"token operator\">:</span> Boolean</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    progressBar<span class=\"token punctuation\">.</span><span class=\"token function\">onNext</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And subscribed to it from the MainActivity:</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Injector<span class=\"token punctuation\">.</span>progressBar<span class=\"token punctuation\">.</span><span class=\"token function\">_subscribeBy_</span><span class=\"token punctuation\">(</span>  \n        onNext <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mainProgress<span class=\"token punctuation\">.</span>_visibility_ \\<span class=\"token operator\">=</span> View<span class=\"token punctuation\">.</span>_VISIBLE_ <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mainProgress<span class=\"token punctuation\">.</span>_visibility_ \\<span class=\"token operator\">=</span> View<span class=\"token punctuation\">.</span>_GONE_ <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>onError <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n        <span class=\"token punctuation\">.</span><span class=\"token function\">_addTo_</span><span class=\"token punctuation\">(</span>compositeDisposable<span class=\"token punctuation\">)</span></code></pre></div>\n<p>These together allow me to toggle the ProgressBar view (that was set up in activity_main) simply by calling <code class=\"language-text\">Injector.setProgressBar(true)</code> and <code class=\"language-text\">Injector.setProgressBar(false)</code>.</p>\n<h4 id=\"second-the-animation\"><a href=\"#second-the-animation\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Second, the Animation</h4>\n<p>Hereâ€™s the fun part. I used <a href=\"https://shapeshifter.design/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Shape Shifter</a> to make the animation, this is what I made:</p>\n<p><img src=\"https://cdn-images-1.medium.com/max/800/1*TOT7NQcg-4VcfbAynbk7vA.gif\"></p>\n<p>Shape Shifter allows you to export the animation as an <code class=\"language-text\">animated-vector</code>Â , made just for Android.</p>\n<p>I found that breaking that <code class=\"language-text\">animated-vector</code> into four separate files worked best. The first is the main file, make sure your ProgressBar uses this.</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>animated<span class=\"token operator\">-</span>vector   \n    android<span class=\"token operator\">:</span>drawable<span class=\"token operator\">=</span><span class=\"token string\">\"@drawable/your\\_vector\\_file\"</span><span class=\"token operator\">></span>  \n  \n    <span class=\"token operator\">&lt;</span>target  \n        android<span class=\"token operator\">:</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"group1\"</span>  \n        android<span class=\"token operator\">:</span>animation<span class=\"token operator\">=</span><span class=\"token string\">\"@anim/your\\_first\\_animation\\_file\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>  \n  \n    <span class=\"token operator\">&lt;</span>target  \n        android<span class=\"token operator\">:</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"group2\"</span>  \n        android<span class=\"token operator\">:</span>animation<span class=\"token operator\">=</span><span class=\"token string\">\"@anim/your\\_second\\_animation\\_file\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>  \n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>animated<span class=\"token operator\">-</span>vector\\<span class=\"token operator\">></span></code></pre></div>\n<p>The vector file, taken from the <code class=\"language-text\">&lt;vector&gt;</code> section of the <code class=\"language-text\">animated-vector</code>Â :</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>vector android<span class=\"token operator\">:</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"vector\"</span>  \n    android<span class=\"token operator\">:</span>viewportWidth<span class=\"token operator\">=</span><span class=\"token string\">\"1024\"</span>  \n    android<span class=\"token operator\">:</span>viewportHeight<span class=\"token operator\">=</span><span class=\"token string\">\"1024\"</span><span class=\"token operator\">></span>  \n    <span class=\"token operator\">&lt;</span>group <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>  \n    <span class=\"token operator\">&lt;</span>group <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>  \n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>vector\\<span class=\"token operator\">></span></code></pre></div>\n<p>And the two animation files taken from the <code class=\"language-text\">&lt;target&gt;</code> sections and placed under <code class=\"language-text\">res/anim/</code>Â . Theyâ€™ll look like this:</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>set\\<span class=\"token operator\">></span>  \n    <span class=\"token operator\">&lt;</span>objectAnimator <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>  \n    <span class=\"token operator\">&lt;</span>objectAnimator <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>  \n    <span class=\"token operator\">&lt;</span>objectAnimator <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>  \n    <span class=\"token operator\">&lt;</span>objectAnimator <span class=\"token operator\">...</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>  \n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>set\\<span class=\"token operator\">></span></code></pre></div>\n<h4 id=\"third-making-it-work\"><a href=\"#third-making-it-work\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Third, Making itÂ Work</h4>\n<p>This was all great, but it didnâ€™t exactly work. The animation wouldnâ€™t repeat itself after it completed. Took a while but finally got it working by doing the following:</p>\n<p>Change <code class=\"language-text\">ProgressBar</code> to <code class=\"language-text\">ImageView</code></p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span>ImageView  \n    android<span class=\"token operator\">:</span>contentDescription<span class=\"token operator\">=</span><span class=\"token string\">\"@string/loading\"</span>  \n    android<span class=\"token operator\">:</span>id<span class=\"token operator\">=</span><span class=\"token string\">\"@+id/progress\\_bar\"</span>  \n    android<span class=\"token operator\">:</span>layout_width<span class=\"token operator\">=</span><span class=\"token string\">\"200dp\"</span>  \n    android<span class=\"token operator\">:</span>layout_height<span class=\"token operator\">=</span><span class=\"token string\">\"200dp\"</span>  \n    android<span class=\"token operator\">:</span>layout_gravity<span class=\"token operator\">=</span><span class=\"token string\">\"center\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>Initialize the animation including <code class=\"language-text\">registerAnimationCallback</code> to force the looping of the animation.</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">val avd <span class=\"token operator\">=</span> AnimatedVectorDrawableCompat<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>_applicationContext_<span class=\"token punctuation\">,</span>            \n                                      <span class=\"token constant\">R</span><span class=\"token punctuation\">.</span>drawable<span class=\"token punctuation\">.</span>_your\\_vector\\_file_<span class=\"token punctuation\">)</span>  \nfindViewById<span class=\"token operator\">&lt;</span>ImageView<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token constant\">R</span><span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">.</span>_progress\\_bar_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>_apply_ <span class=\"token punctuation\">{</span> <span class=\"token function\">setImageDrawable</span><span class=\"token punctuation\">(</span>avd<span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">}</span>  \navd<span class=\"token operator\">?.</span><span class=\"token function\">registerAnimationCallback</span><span class=\"token punctuation\">(</span>obj<span class=\"token operator\">:</span>Animatable2Compat<span class=\"token punctuation\">.</span><span class=\"token function\">AnimationCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    override fun <span class=\"token function\">onAnimationEnd</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">drawable<span class=\"token operator\">:</span> Drawable<span class=\"token operator\">?</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        avd<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>To top it off, I added <code class=\"language-text\">start()</code> and <code class=\"language-text\">stop()</code> to my <code class=\"language-text\">_subscribeBy_</code> method just to be nice:</p>\n<div class=\"gridsome-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Injector<span class=\"token punctuation\">.</span>progressBar<span class=\"token punctuation\">.</span><span class=\"token function\">_subscribeBy_</span><span class=\"token punctuation\">(</span>  \n        onNext <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mainProgress<span class=\"token punctuation\">.</span>_visibility_ \\<span class=\"token operator\">=</span> View<span class=\"token punctuation\">.</span>_VISIBLE_ avd<span class=\"token operator\">?</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>_ <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mainProgress<span class=\"token punctuation\">.</span>_visibility_ \\<span class=\"token operator\">=</span> View<span class=\"token punctuation\">.</span>_GONE_ avd<span class=\"token operator\">?</span>_<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>_ <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>onError <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n        <span class=\"token punctuation\">.</span><span class=\"token function\">_addTo_</span><span class=\"token punctuation\">(</span>compositeDisposable<span class=\"token punctuation\">)</span></code></pre></div>\n<p>This last step took me a while to figure out but I finally got it thanks to <a href=\"https://medium.com/androiddevelopers/re-animation-7869722af206\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this article</a> from the Android Developers blog.</p>\n<p>Overall I loved the chance to work on some animation, I think itâ€™s just going to become a bigger thing in 2019 and more of a priority for me to learn!</p>\n<h4 id=\"krugo-travel\"><a href=\"#krugo-travel\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Krugo Travel</h4>\n<p>Quick shoutout to the company Iâ€™m working for, Krugo. Iâ€™m working on getting the Android app up and running hence why I was doing this little animation in Android!</p>\n<blockquote>\n<p>Have you ever been frustrated trying to plan a trip with a group of people? Maybe a bachelor party, family vacation or trip with the girls? If so, youâ€™re not alone.</p>\n<p>And weâ€™ve made it our mission to help.</p>\n</blockquote>\n<p>Krugo helps groups of friends collaboratively plan trips by finding events, buying tickets and getting a place to stay. Canâ€™t wait to take my own Krugo soon ðŸ˜œ</p>\n<p>Check â€™em out on <a href=\"https://medium.com/@krugo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Medium</a> or get the <a href=\"https://krugotravel.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">app for iOS</a>. Android coming soon!</p>\n","date":"January 15, 2019","timeToRead":3,"cover":"https://cdn-images-1.medium.com/max/800/1*TOT7NQcg-4VcfbAynbk7vA.gif","description":"Recently at Krugo, I was asking to implement a custom loading animation. I donâ€™t usually write about work things, but this one wasâ€¦"}},"context":{}}